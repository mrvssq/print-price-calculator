<!doctype html>
<html lang="ru" data-bs-theme="light">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Калькулятор — Листовки</title>

  <!-- Bootstrap 5 (CSS) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Твои (опциональные) общие стили, если нужны -->
  <link rel="stylesheet" href="./app.css">
</head>
<body class="min-vh-100">
<div class="container py-4 position-relative">

  <!-- Хедер -->
  <header class="d-flex align-items-center justify-content-between mb-3">
    <h1 class="h4 m-0">Калькулятор — <span class="text-primary">Листовки</span></h1>
    <div class="d-flex align-items-center gap-2">
      <span id="testBadge" class="badge text-bg-secondary d-none">Тесты не запускались</span>
      <button id="themeToggle" type="button" class="btn btn-outline-secondary btn-sm">
        Тема: <span id="themeLabel">Light</span>
      </button>
    </div>
  </header>

  <!-- Оверлей блокировки -->
  <div id="lockOverlay"
       class="position-fixed top-0 start-0 w-100 h-100 d-none align-items-center justify-content-center"
       style="z-index:1050; backdrop-filter:saturate(80%) blur(1px); background-color:rgba(0,0,0,.5);">
    <div class="text-center text-light">
      <div class="spinner-border mb-3" role="status" aria-hidden="true"></div>
      <div class="fs-5" id="lockMessage">Загружаем цены…</div>
      <div class="small text-warning mt-1" id="lockHint"></div>
      <div id="devPanel" class="mt-3 d-none">
        <input id="priceFile" type="file" accept="application/json" class="d-none">
        <button id="btnLoadDevPrices" type="button" class="btn btn-outline-light btn-sm">
          Загрузить prices.dev.json
        </button>
      </div>
    </div>
  </div>

  <div class="row g-3" id="configBlock">
    <!-- Левая колонка: опции -->
    <div class="col-lg-8">
      <div class="card">
        <div class="card-body">
          <h2 class="h6 mb-3">Параметры</h2>

          <!-- Дизайн -->
          <div class="mb-3">
            <label class="form-label">Дизайн</label>
            <div class="d-flex gap-3 flex-wrap">
              <div class="form-check">
                <input class="form-check-input" type="radio" name="design" id="design_none" value="none" checked>
                <label class="form-check-label" for="design_none">Есть макет</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="design" id="design_template" value="template">
                <label class="form-check-label" for="design_template">Шаблон</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="design" id="design_premium" value="premium">
                <label class="form-check-label" for="design_premium">Индивидуальный</label>
              </div>
            </div>
          </div>

          <!-- Размер -->
          <div class="mb-3">
            <label class="form-label">Размер</label>
            <div class="d-flex gap-3 flex-wrap">
              <div class="form-check"><input class="form-check-input" type="radio" name="size" id="size_A6" value="A6" checked><label class="form-check-label" for="size_A6">A6</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="size" id="size_A5" value="A5"><label class="form-check-label" for="size_A5">A5</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="size" id="size_A4" value="A4"><label class="form-check-label" for="size_A4">A4</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="size" id="size_A3" value="A3"><label class="form-check-label" for="size_A3">A3</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="size" id="size_EURO" value="EURO"><label class="form-check-label" for="size_EURO">Евро (210×98)</label></div>
            </div>
          </div>

          <!-- Печать -->
          <div class="mb-3">
            <label class="form-label" for="print">Печать</label>
            <select id="print" class="form-select">
              <option value="single">Односторонняя</option>
              <option value="double">Двусторонняя</option>
            </select>
          </div>

          <!-- Тип бумаги -->
          <div class="mb-3">
            <label class="form-label">Бумага</label>
            <div class="d-flex gap-3 flex-wrap">
              <div class="form-check">
                <input class="form-check-input" type="radio" name="stock" id="stock_gloss" value="gloss" checked>
                <label class="form-check-label" for="stock_gloss">Глянцевая</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="stock" id="stock_matte" value="matte">
                <label class="form-check-label" for="stock_matte">Матовая</label>
              </div>
              <div class="form-check">
                <input class="form-check-input"
                       type="radio" name="stock" id="stock_designer" value="designer"
                       data-bs-toggle="tooltip" data-bs-placement="top"
                       title="Дизайнерская бумага: спец. фактуры и покрытия (SoftTouch, тиснение, текстуры). Премиальный вид.">
                <label class="form-check-label" for="stock_designer">Дизайнерская</label>
              </div>
            </div>
          </div>

          <!-- Плотность -->
          <div class="mb-3">
            <label class="form-label">Плотность бумаги</label>
            <div class="d-flex gap-3 flex-wrap">
              <div class="form-check"><input class="form-check-input" type="radio" name="gsm" id="gsm_80" value="80"><label class="form-check-label" for="gsm_80">80</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="gsm" id="gsm_115" value="115"><label class="form-check-label" for="gsm_115">115</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="gsm" id="gsm_150" value="150"><label class="form-check-label" for="gsm_150">150</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="gsm" id="gsm_200" value="200"><label class="form-check-label" for="gsm_200">200</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="gsm" id="gsm_300" value="300" checked><label class="form-check-label" for="gsm_300">300</label></div>
            </div>
          </div>

          <!-- Ламинация -->
          <div class="mb-3">
            <label class="form-label">Ламинация</label>
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" id="lamination">
              <label class="form-check-label" for="lamination">Включить ламинацию</label>
            </div>
          </div>

          <!-- Беговка -->
          <div class="mb-3">
            <label class="form-label" for="creasing">Беговка</label>
            <select id="creasing" class="form-select">
              <option value="0">Выкл</option>
              <option value="1">1 беговка</option>
              <option value="2">2 беговки</option>
              <option value="3">3 беговки</option>
            </select>
          </div>

          <!-- Закругление углов -->
          <div class="mb-3">
            <label class="form-label">Углы</label>
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" id="rounded">
              <label class="form-check-label" for="rounded">Закруглённые углы</label>
            </div>
          </div>

          <!-- Тираж -->
          <div class="mb-3">
            <label class="form-label">Тираж</label>
            <div class="row g-2">
              <div class="col-sm-6">
                <input id="qty" type="number" class="form-control" min="1" maxlength="10" step="1" value="100" oninput="this.value=this.value.replace(/\D/g,'').slice(0,10)||'1'">
              </div>
              <div class="col-sm-6">
                <select id="qtyPreset" class="form-select">
                  <option value="custom">Произвольно…</option>
                  <option value="1">1 шт.</option>
                  <option value="10">10 шт.</option>
                  <option value="50">50 шт.</option>
                  <option value="100" selected>100 шт.</option>
                  <option value="200">200 шт.</option>
                  <option value="500">500 шт.</option>
                  <option value="1000">1000 шт.</option>
                </select>
              </div>
            </div>
            <div class="form-text">Можно указать <strong>даже 1 лист</strong>.</div>
          </div>

          <!-- Срок -->
          <div class="mb-1">
            <label class="form-label" for="urgency">Срок изготовления</label>
            <select id="urgency" class="form-select">
              <option value="oneday">1 рабочий день</option>
              <option value="express">2–3 часа (+50%)</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- Правая колонка: ИТОГО -->
    <div class="col-lg-4">
      <div id="totalBlock" class="card" data-updated="">
        <div class="card-body">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <span class="badge text-bg-secondary">ИТОГО</span>
            <div class="btn-group btn-group-sm">
              <button id="btnShare" class="btn btn-outline-secondary">Поделиться</button>
              <button id="btnDownload" class="btn btn-outline-primary">Скачать спецификацию (PDF)</button>
            </div>
          </div>

          <div class="table-responsive">
            <table class="table table-sm align-middle mb-2">
              <tbody>
                <tr><td>Размер</td><td class="text-end" id="lineSize">—</td></tr>
                <tr><td>Печать</td><td class="text-end" id="linePrint">—</td></tr>
                <tr><td>Бумага</td><td class="text-end" id="lineStock">—</td></tr>
                <tr><td>Плотность</td><td class="text-end" id="lineGsm">—</td></tr>

                <tr id="rowLamination"><td>Ламинация</td><td class="text-end" id="lineLamination">—</td></tr>
                <tr id="rowCreasing"><td>Беговка</td><td class="text-end" id="lineCreasing">—</td></tr>
                <tr id="rowRounded"><td>Углы</td><td class="text-end" id="lineRounded">—</td></tr>

                <tr class="table-active"><td>Тираж</td><td class="text-end" id="lineQty">—</td></tr>

                <tr id="rowDiscount"><td>Скидка за тираж</td><td class="text-end" id="lineDiscount">—</td></tr>
                <tr><td>Срочность</td><td class="text-end" id="lineUrgency">—</td></tr>
                <tr><td>Дизайн</td><td class="text-end" id="lineDesign">—</td></tr>

                <tr><th class="fs-5">Итого к оплате</th><th class="text-end fs-5" id="total">—</th></tr>
              </tbody>

            </table>
          </div>


          <div id="eta" class="small text-secondary"></div>
        </div>

        


      </div>

      <!-- dev-подсмотр прайса -->
      <div id="devPricesDetails" class="card mt-3 d-none">
        <div class="card-header py-2">Используемые цены</div>
        <pre id="priceJson" class="m-0 p-2 small"></pre>
      </div>
    </div>
  </div>

</div>

<!-- Bootstrap 5 (JS bundle) — ДОЛЖЕН идти до твоих скриптов -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

<!-- jQuery (если используешь в своём коде; не обязателен для Bootstrap 5) -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

<!-- Переключатель темы (Bootstrap 5.3 data-bs-theme) -->
<script>
  (function () {
    const STORAGE_KEY = 'bsTheme';
    const root = document.documentElement; // <html>
    const saved = localStorage.getItem(STORAGE_KEY) || 'light';
    root.setAttribute('data-bs-theme', saved);
    const label = document.getElementById('themeLabel');
    if (label) label.textContent = saved === 'dark' ? 'Dark' : 'Light';

    const btn = document.getElementById('themeToggle');
    if (btn) {
      btn.addEventListener('click', () => {
        const next = root.getAttribute('data-bs-theme') === 'dark' ? 'light' : 'dark';
        root.setAttribute('data-bs-theme', next);
        localStorage.setItem(STORAGE_KEY, next);
        if (label) label.textContent = next === 'dark' ? 'Dark' : 'Light';
      });
    }
  })();
</script>

<!-- Твоя логика для Листовок -->
<script src="./leaflets.js"></script>
</body>
</html>
