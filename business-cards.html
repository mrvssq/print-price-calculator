<!doctype html>
<html lang="ru" data-bs-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Калькулятор — Визитки</title>
    <!-- Bootstrap 5 (CSS) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Твои (опциональные) общие стили, если нужны -->
    <link rel="stylesheet" href="./app.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  </head>
  <body>
    <!-- Offcanvas меню слева -->
    <div class="offcanvas offcanvas-start" id="calcOffcanvas" tabindex="-1" id="calcOffcanvas" aria-labelledby="calcOffcanvasLabel">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="calcOffcanvasLabel">Калькуляторы</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Закрыть"></button>
      </div>
      <div class="offcanvas-body">
        <nav class="list-group">
          <a id="mLinkCards" class="list-group-item list-group-item-action" href="business-cards.html">Визитки</a>
          <a id="mLinkLeaflets" class="list-group-item list-group-item-action" href="leaflets.html">Листовки</a>
        </nav>
      </div>
    </div>
    <!-- Top navbar -->
    <nav class="navbar navbar-expand-lg bg-body-tertiary border-bottom mb-3">
      <div class="container-fluid">
        <!-- Кнопка открытия offcanvas (мобилка/планшет) -->
        <button class="btn btn-outline-secondary me-2 d-lg-none" data-bs-toggle="offcanvas" data-bs-target="#calcOffcanvas" aria-controls="calcOffcanvas">
          <i class="bi bi-list"></i>
          <!-- можно заменить на <span class="fa fa-bars"></span> если используешь Font Awesome -->
        </button>
        <!-- Лого/бренд -->
        <a class="navbar-brand d-flex align-items-center gap-2" href="/">
          <!-- <img src="https://getbootstrap.com/docs/5.3/assets/brand/bootstrap-logo.svg" alt="" width="28" height="22" class="d-inline-block"> --> Мультисервис Калькулятор
        </a>
        <!-- Правая зона: аватар-меню + поиск (как в твоём примере) -->
        <div class="d-flex align-items-center ms-auto gap-2">
          <button id="themeToggle" type="button" class="btn btn-outline-secondary btn-sm"> Тема: <span id="themeLabel">Light</span>
          </button>
        </div>
      </div>
    </nav>
    <!-- Левый стационарный сайдбар (для ≥ lg) + контент -->
    <div class="container-fluid">
      <div class="row g-3">
        <aside id="sidebarCol" class="col-lg-3 d-none d-lg-block">
          <nav class="card position-sticky" style="top:1rem">
            <div class="list-group list-group-flush">
              <a id="linkCards" class="list-group-item list-group-item-action" href="business-cards.html">Визитки</a>
              <a id="linkLeaflets" class="list-group-item list-group-item-action" href="leaflets.html">Листовки</a>
            </div>
          </nav>
        </aside>
        <main class="col-lg-9">
          <!-- Хедер -->
          <header class="d-flex align-items-center justify-content-between mb-3">
            <h1 class="h4 m-0">Калькулятор — <span class="text-primary">Визитки</span>
            </h1>
          </header>
          <!-- Оверлей блокировки -->
          <div id="lockOverlay" class="position-fixed top-0 start-0 w-100 h-100 d-none align-items-center justify-content-center" style="z-index:1050; backdrop-filter:saturate(80%) blur(1px); background-color:rgba(0,0,0,.5);">
            <div class="text-center text-light">
              <div class="spinner-border mb-3" role="status" aria-hidden="true"></div>
              <div class="fs-5" id="lockMessage">Загружаем цены…</div>
              <div class="small text-warning mt-1" id="lockHint"></div>
              <div id="devPanel" class="mt-3 d-none">
                <input id="priceFile" type="file" accept="application/json" class="d-none">
                <button id="btnLoadDevPrices" type="button" class="btn btn-outline-light btn-sm"> Загрузить prices.dev.json </button>
              </div>
            </div>
          </div>
          <div class="row g-3" id="configBlock">
            <!-- Левая колонка: опции -->
            <div class="col-lg-8">
              <div class="card">
                <div class="card-body">
                  <h2 class="h6 mb-3">Параметры</h2>
                  <!-- Дизайн -->
                  <div class="mb-3">
                    <label class="form-label">Дизайн</label>
                    <div class="btn-group flex-wrap" role="group" aria-label="Дизайн">
                      <input type="radio" class="btn-check" name="design" id="design_none" value="none" autocomplete="off">
                      <label class="btn btn-outline-secondary btn-radio" for="design_none">Есть макет</label>
                      <input type="radio" class="btn-check" name="design" id="design_template" value="template" autocomplete="off" checked>
                      <label class="btn btn-outline-secondary btn-radio" for="design_template" data-bs-toggle="tooltip" data-bs-placement="top" title="Бесплатно: выберем готовый шаблон и подставим ваши данные.">Бесплатный</label>
                      <input type="radio" class="btn-check" name="design" id="design_premium" value="premium" autocomplete="off">
                      <label class="btn btn-outline-secondary btn-radio" for="design_premium">Индивидуальный</label>
                    </div>
                  </div>
                  <!-- Размер -->
                  <div class="mb-3">
                    <label class="form-label">Размер</label>
                    <div class="btn-group flex-wrap" role="group" aria-label="Размер">
                      <input type="radio" class="btn-check" name="size" id="size_90x50" value="90x50" autocomplete="off" checked>
                      <label class="btn btn-outline-secondary btn-radio" for="size_90x50">Стандарт 90×50 мм</label>
                      <input type="radio" class="btn-check" name="size" id="size_60x60" value="60x60" autocomplete="off">
                      <label class="btn btn-outline-secondary btn-radio" for="size_60x60">Квадрат 60×60 мм</label>
                    </div>
                  </div>
                  <!-- Печать -->
                  <div class="mb-3">
                    <label class="form-label">Печать</label>
                    <div class="btn-group flex-wrap" role="group" aria-label="Печать">
                      <input type="radio" class="btn-check" name="print" id="print_single" value="single" autocomplete="off">
                      <label class="btn btn-outline-primary btn-radio" for="print_single">Односторонняя</label>
                      <input type="radio" class="btn-check" name="print" id="print_double" value="double" autocomplete="off" checked>
                      <label class="btn btn-outline-primary btn-radio" for="print_double">Двусторонняя</label>
                    </div>
                  </div>
                  <!-- Материал -->
                  <div class="mb-3">
                    <label class="form-label">Материал</label>
                    <div class="btn-group flex-wrap" role="group" aria-label="Материал">
                      <input type="radio" class="btn-check" name="material" id="mat_paper300" value="paper300" autocomplete="off" checked>
                      <label class="btn btn-outline-secondary btn-radio" for="mat_paper300">Бумага 300 г/м²</label>
                      <input type="radio" class="btn-check" name="material" id="mat_designer" value="designer" autocomplete="off" data-bs-toggle="tooltip" data-bs-placement="top" title="Дизайнерская: фактуры/покрытия (SoftTouch и т.п.), премиальный вид.">
                      <label class="btn btn-outline-secondary btn-radio" for="mat_designer">Дизайнерская бумага</label>
                      <input type="radio" class="btn-check" name="material" id="mat_plastic" value="plastic" autocomplete="off">
                      <label class="btn btn-outline-secondary btn-radio" for="mat_plastic">Пластик</label>
                    </div>
                  </div>
                  <!-- Дополнительно -->
                  <div class="mb-3">
                    <label class="form-label">Дополнительно</label>
                    <div class="btn-group flex-wrap" role="group" aria-label="Финишные опции">
                      <!-- Ламинация -->
                      <input type="checkbox" class="btn-check" id="lamination" autocomplete="off">
                      <label class="btn btn-outline-secondary btn-toggle" for="lamination"> Ламинация <span class="state off">✖️ Выкл</span>
                        <span class="state on">✅ Вкл</span>
                      </label>
                      <!-- Закруглённые углы -->
                      <input type="checkbox" class="btn-check" id="rounded" autocomplete="off">
                      <label class="btn btn-outline-secondary btn-toggle" for="rounded"> Углы <span class="state off">✖️ Выкл</span>
                        <span class="state on">✅ Вкл</span>
                      </label>
                    </div>
                  </div>
                  <!-- Тираж -->
                  <div class="mb-3">
                    <label class="form-label">Тираж, шт.</label>
                    <div class="row g-2">
                      <div class="col-sm-6">
                        <input id="qty" type="number" class="form-control" inputmode="numeric">
                        <div id="qtyHint" class="form-text"></div>
                      </div>

                      <div class="col-sm-6">
                        <select id="qtyPreset" class="form-select">
                          <option value="custom">Произвольно…</option>
                          <option value="120" selected>120 шт.</option>
                          <option value="240">240 шт.</option>
                          <option value="480">480 шт.</option>
                          <option value="960">960 шт.</option>
                          <option value="1920">1920 шт.</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <!-- Срок изготовления -->
                  <div class="mb-1">
                    <label class="form-label" for="urgency">Срок изготовления</label>
                    <select id="urgency" class="form-select">
                      <option value="oneday">1-2 рабоих дня</option>
                      <option value="express">3–5 часов (+50% к цене)</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
            <!-- Правая колонка: ИТОГО -->
            <div class="col-lg-4">
              <div id="totalBlock" class="card receipt border-0" data-updated="">
                <div class="card-body">
                  <div class="d-flex align-items-center justify-content-between mb-2">
                    <span class="badge text-bg-secondary">ИТОГО</span>
                  </div>
                  <div class="table-responsive">
                    <table class="table table-sm align-middle mb-2 receipt-table">
                      <tbody>
                        <tr class="table-active">
                          <td>Тираж</td>
                          <td class="text-end" id="lineQty">—</td>
                        </tr>
                        <tr>
                          <td>Размер</td>
                          <td class="text-end" id="lineSize">—</td>
                        </tr>
                        <tr>
                          <td>Печать</td>
                          <td class="text-end" id="linePrint">—</td>
                        </tr>
                        <tr>
                          <td>Материал</td>
                          <td class="text-end" id="lineMaterial">—</td>
                        </tr>
                        <tr id="rowLamination">
                          <td>Ламинация</td>
                          <td class="text-end" id="lineLamination">—</td>
                        </tr>
                        <tr id="rowRounded">
                          <td>Углы</td>
                          <td class="text-end" id="lineRounded">—</td>
                        </tr>
                        <tr id="rowDiscount">
                          <td>Скидка за тираж</td>
                          <td class="text-end" id="lineDiscount">—</td>
                        </tr>
                        <tr>
                          <td>Дизайн</td>
                          <td class="text-end" id="lineDesign">—</td>
                        </tr>
                        <tr id="rowPerItem">
                          <td>Цена за 1 шт.</td>
                          <td class="text-end" id="linePerItem">—</td>
                        </tr>
                        <tr>
                          <td>Срок изготовления</td>
                          <td class="text-end" id="lineUrgency">—</td>
                        </tr>
                        <tr class="receipt-total">
                          <th class="fs-5">Итого к оплате</th>
                          <th class="text-end fs-5" id="total">—</th>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div id="eta" class="small text-secondary mt-2"></div>
                  <!-- Кромка чека ВНУТРИ card-body -->
                  <div class="tearoff mt-2" aria-hidden="true"></div>
                </div>
              </div>
              <!-- Кнопки — снизу, отдельно от чека -->
              <div class="mt-3">
                <div class="row g-2 mb-2">
                  <!-- <div class="col-12 col-md-6">
                    <button id="btnShare" class="btn btn-outline-secondary w-100">Поделиться</button>
                  </div> -->
                  <div class="col-12 col-md-6">
                    <button id="btnCopy" class="btn btn-outline-secondary w-100">Скопировать</button>
                  </div>
                  <div class="col-12 col-md-6">
                  <button id="btnDownload" class="btn btn-outline-primary w-100">Сохранить в PDF</button>
                </div>
                </div>
              </div>
              <!-- dev-подсмотр прайса -->
              <div id="devPricesDetails" class="card mt-3 d-none">
                <div class="card-header py-2">Используемые цены</div>
                <pre id="priceJson" class="m-0 p-2 small"></pre>
              </div>
            </div>
          </div>
          <!-- Подсказки по опциям -->
          <section class="mt-4">
            <h2 class="h5 mb-3">Что это за опции</h2>
            <div class="row gy-3">
              <!-- Бесплатный дизайн -->
              <div class="col-md-6">
                <div class="d-flex gap-3 align-items-start p-3 border rounded-3">
                  <svg width="40" height="40" viewBox="0 0 24 24" class="text-body" fill="none" aria-hidden="true">
                    <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="1.5" />
                    <path d="M7 8h10M7 12h8M7 16h6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                  </svg>
                  <div>
                    <div class="fw-semibold">Бесплатный дизайн</div>
                    <div class="small text-secondary"> Готовые шаблоны на выбор — мы подставим ваши данные и адаптируем цвета под бренд. </div>
                  </div>
                </div>
              </div>
              <!-- Материалы -->
              <div class="col-md-6">
                <div class="d-flex gap-3 align-items-start p-3 border rounded-3">
                  <svg width="40" height="40" viewBox="0 0 24 24" class="text-body" fill="none" aria-hidden="true">
                    <rect x="4" y="6" width="16" height="10" rx="2" stroke="currentColor" stroke-width="1.5" />
                    <path d="M6 8h6m-6 4h4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                    <path d="M5 18h14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                  </svg>
                  <div>
                    <div class="fw-semibold">Материалы</div>
                    <div class="small text-secondary"> От простой бумаги до пластика. Плотная бумага 300&nbsp;г/м² — классика; дизайнерские бумаги дают премиальный вид. </div>
                  </div>
                </div>
              </div>
              <!-- Ламинация -->
              <div class="col-md-6">
                <div class="d-flex gap-3 align-items-start p-3 border rounded-3">
                  <svg width="40" height="40" viewBox="0 0 24 24" class="text-body" fill="none" aria-hidden="true">
                    <path d="M12 3l9 5-9 5L3 8l9-5Z" stroke="currentColor" stroke-width="1.5" fill="none" />
                    <path d="M21 13l-9 5-9-5" stroke="currentColor" stroke-width="1.5" fill="none" />
                  </svg>
                  <div>
                    <div class="fw-semibold">Ламинация</div>
                    <div class="small text-secondary"> Плёнка (мат/глянец) защищает от влаги и истирания, увеличивает срок службы. </div>
                  </div>
                </div>
              </div>
              <!-- Скруглённые углы -->
              <div class="col-md-6">
                <div class="d-flex gap-3 align-items-start p-3 border rounded-3">
                  <svg width="40" height="40" viewBox="0 0 24 24" class="text-body" fill="none" aria-hidden="true">
                    <path d="M6 5h8a5 5 0 0 1 5 5v6a3 3 0 0 1-3 3H8a5 5 0 0 1-5-5V8a3 3 0 0 1 3-3Z" stroke="currentColor" stroke-width="1.5" fill="none" />
                  </svg>
                  <div>
                    <div class="fw-semibold">Скруглённые углы</div>
                    <div class="small text-secondary"> Радиус 3–5&nbsp;мм: аккуратнее внешний вид, меньше заломов. </div>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </main>
        <script>
          function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            sidebar.classList.toggle('collapsed');
          }
        </script>
      </div>
      <!-- Bootstrap 5 (JS bundle) — ДОЛЖЕН идти до твоих скриптов -->
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
      <!-- jQuery (если используешь в своём коде; не обязателен для Bootstrap 5) -->
      <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
      <!-- Твоя логика для Листовок -->
      <script src="./common.js"></script>
      <script src="./business-cards.js"></script>
      <script>
        // Установит сохранённую тему или light по умолчанию и повесит обработчик на кнопку
        Common.initTheme({
          defaultTheme: 'light',
          buttonId: 'themeToggle',
          labelId: 'themeLabel'
        });
      </script>
  </body>
</html>