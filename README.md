Работающий пример:
Визитки https://multiserwis.ru/calc/business-cards.html
Листовки https://multiserwis.ru/calc/leaflets.html

# README — как редактировать `prices.json`

Этот файл описывает цены и правила расчёта для всех калькуляторов (листовки, визитки и т.д.).  
Он задуман как **универсальный**: одна структура — разные продукты.

> **Важно:** файл — обычный JSON **без комментариев**. Если нужна «черновая» версия с комментариями, используйте `prices.dev.json`, а перед продом снимайте комментарии.

---

## Содержание

- [Общая структура файла](#общая-структура-файла)
- [Секция `meta`](#секция-meta)
- [Секция `shared` (общие настройки для всех продуктов)](#секция-shared-общие-настройки-для-всех-продуктов)
  - [`fees.designFee`](#feesdesignfee)
- [Секция `products`](#секция-products)
  - [Листовки (`leaflets`)](#листовки-leaflets)
    - [`base`](#leaflets-base)
    - [`options`](#leaflets-options)
    - [`urgencyK`](#leaflets-urgencyk)
    - [`qtyRules`](#leaflets-qtyrules)
    - [`discountByAmount`](#leaflets-discountbyamount)
  - [Визитки (`cards`)](#визитки-cards)
    - [`base`](#cards-base)
    - [`options`](#cards-options)
    - [`urgencyK`](#cards-urgencyk)
    - [`qtyRules`](#cards-qtyrules)
    - [`discountByAmount`](#cards-discountbyamount)
- [Как устроены скидки](#как-устроены-скидки)
- [Как устроена срочность](#как-устроена-срочность)
- [Правила округления тиража](#правила-округления-тиража)
- [Чек-лист перед деплоем](#чеклист-перед-деплоем)
- [Пример полного файла](#пример-полного-файла)

---

## Общая структура файла

```json
{
  "meta": { ... },
  "shared": {
    "fees": { ... }
  },
  "products": {
    "leaflets": { ... },
    "cards": { ... }
  }
}
```

Все цены — в **рублях**. Все множители — **безразмерные коэффициенты**.

---

## Секция `meta`

Метаданные (для отображения и совместимости).

```json
{
  "version": "2.3.0",
  "updated": "2025-10-17"
}
```

- `version` — произвольная строка версии схемы/цен.
- `updated` — дата обновления (YYYY-MM-DD), показывается в чеке.

---

## Секция `shared` (общие настройки для всех продуктов)

### `fees.designFee`

Единая таблица цен за дизайн:

```json
{
  "shared": {
    "fees": {
      "designFee": {
        "none": 0,
        "template": 0,
        "premium": 1500
      }
    }
  }
}
```

- `none` — дизайн не требуется.
- `template` — бесплатно: подставим данные в готовый макет.
- `premium` — индивидуальный дизайн. **Важно:** для визиток цена дизайна добавляется **всегда** при выборе `premium`. Для листовок — тоже поддерживается (если фронт включает эту опцию).

---

## Секция `products`

Детальные прайс-настройки по продуктам. Ниже — описание каждой сущности.

---

## Листовки (`leaflets`)

### <a id="leaflets-base"></a>`base`

База — цена за **1 лист** до опций, скидок и срочности.

```json
{
  "base": {
    "sizes": ["A6","A5","A4","EURO","A3"],
    "gsmList": ["80","115","150","200","300"],

    "basePerItemSingle": {
      "A6":  { "80": 8,  "115": 10, "150": 12, "200": 13,  "300": 15 },
      "A5":  { "80": 15, "115": 20, "150": 23, "200": 25,  "300": 30 },
      "A4":  { "80": 30, "115": 40, "150": 45, "200": 50,  "300": 60 },
      "EURO":{"80": 30, "115": 40, "150": 45, "200": 50,  "300": 60 },
      "A3":  { "80": 50, "115": 70, "150": 85, "200": 100, "300": 120 }
    },

    "doublePrintMultiplier": 1.40
  }
}
```

- `sizes` — список поддерживаемых форматов.
- `gsmList` — допустимые плотности бумаги.
- `basePerItemSingle[size][gsm]` — цена **односторонней** печати за 1 лист (руб).
- `doublePrintMultiplier` — множитель к цене за **двустороннюю** печать (например, 1.40 = +40%).

> **Логика “порог A4”:** если итоговая цена (за выбранный формат) **ниже** цены 1 листа **A4** той же плотности (до дизайна/срочности), тарифицируем как **1×A4**.  
> Это защищает от аномально низкой цены при малом тираже на мелких форматах (A6/A5/EURO).

### <a id="leaflets-options"></a>`options`

Опции, влияющие на цену 1 листа:

```json
{
  "options": {
    "laminationMultiplier": 1.40,
    "roundedCornersPerItem": 2.0,
    "creasingPerLine": 3.0,
    "designerPaperMultiplier": 1.30
  }
}
```

- `laminationMultiplier` — множитель (например, ламинация +40%).
- `roundedCornersPerItem` — фиксированная надбавка (руб/лист).
- `creasingPerLine` — доплата за линию беговки (руб/лист/линия).
- `designerPaperMultiplier` — множитель для дизайнерской бумаги (к базовой цене бумаги).

### <a id="leaflets-urgencyk"></a>`urgencyK`

Срочность применяется **после всех скидок и дизайна**:

```json
{ "oneday": 1.0, "express": 1.5 }
```

- `express` = +50% к итоговой сумме (последним шагом).

### <a id="leaflets-qtyrules"></a>`qtyRules`

Ограничения по тиражу (минимум / кратность):

```json
{ "min": 1, "pack": 1 }
```

- `min` — минимальный тираж.
- `pack` — кратность (1 = без ограничений).

### <a id="leaflets-discountbyamount"></a>`discountByAmount`

Плавная скидка от **суммы заказа** (до дизайна и срочности):

```json
{
  "startAmount": 1500,  "startRate": 0.05,
  "midAmount":   4000,  "midRate":   0.15,
  "capAmount":  20000,  "capRate":   0.30
}
```

- Ниже `startAmount` — 0%.
- Между точками — линейная интерполяция (плавная скидка).
- Выше `capAmount` — максимум `capRate` (например, 30%).

---

## Визитки (`cards`)

### <a id="cards-base"></a>`base`

База — цена за **1 визитку до опций/скидок/срочности**.  
Мы задаём **готовые цены** по материалу и стороне (односторонняя/двусторонняя).

```json
{
  "base": {
    "sizes": ["90x50","60x60"],

    "basePerItem": {
      "paper300": { "single": 5,   "double": 9   },
      "designer": { "single": 30,  "double": 40  },
      "plastic":  { "single": 100, "double": 200 }
    }
  }
}
```

- `sizes` — размеры визиток.
- `basePerItem[material][print]` — руб/шт:
  - `paper300` — бумага 300 г/м²
  - `designer` — дизайнерская бумага
  - `plastic` — пластик

> **Замечание:** для пластика автоматически **отключаем** ламинацию и скруглённые углы (невозможная комбинация).

### <a id="cards-options"></a>`options`

```json
{
  "options": {
    "laminationMultiplier": 2.0,
    "roundedCornersPerItem": 2.0
  }
}
```

- `laminationMultiplier` — множитель к **базовой цене визитки** (ламинация ×2).
- `roundedCornersPerItem` — руб/шт (например, 2₽).

### <a id="cards-urgencyk"></a>`urgencyK`

```json
{ "oneday": 1.0, "express": 1.5 }
```

- `express` (3–5 часов) = +50% к итоговой сумме **после** скидки и дизайна.

### <a id="cards-qtyrules"></a>`qtyRules`

Ограничения тиража (можно задать **общие** и **пер-материальные** правила):

```json
{
  "min": 120,
  "pack": 24,
  "perMaterial": {
    "paper300": { "min": 120, "pack": 24 },
    "designer": { "min": 120, "pack": 24 },
    "plastic":  { "min": 30,  "pack": 1  }
  }
}
```

Фронт сам применит нужное правило при выборе материала.

### <a id="cards-discountbyamount"></a>`discountByAmount`

Схема скидок как у листовок, но независимая (можно настроить иначе):

```json
{
  "startAmount": 1500,  "startRate": 0.05,
  "midAmount":   4000,  "midRate":   0.15,
  "capAmount":  20000,  "capRate":   0.30
}
```

---

## Как устроены скидки

- Считаем **сумму до скидки**: базовая цена + допы (ламинация/углы/беговка и т.п.).
- Применяем **плавную скидку по сумме** по схеме `discountByAmount`.
- Для чека:
  - «Скидка за тираж» — показывается строкой (зелёным).
  - «Цена за 1 лист/шт» — показываем **со скидкой** (но **без** дизайна и **без** срочности): `afterDiscount / qty`.

---

## Как устроена срочность

- Множитель `urgencyK` применяется **в самом конце**:  
  `(сумма после скидки + дизайн) × urgencyK`.
- Это касается и листовок, и визиток.

---

## Правила округления тиража

- Листовки: задаются общие `min` и `pack`.
- Визитки: можно задать `perMaterial` (например, пластик — свой минимум и без кратности).
- Ввод пользователя свободный: фронт подскажет/скорректирует (округление вверх до кратного `pack`, не ниже `min`).

---

## Чек-лист перед деплоем

1. `prices.json` — **чистый JSON** (без комментариев, без хвостовых запятых).
2. Поля `meta.version` и `meta.updated` актуальны.
3. Проверить, что списки `sizes` и `gsmList` совпадают с тем, что реально доступно в UI.
4. На ключевых кейсах:
   - Визитки/пластик: ламинация/углы выключены.
   - Листовки/A6|A5|EURO с маленьким тиражом — срабатывает порог **1×A4**.
   - «Цена за 1 лист/шт» в чеке — **со скидкой** (без дизайна/срочности).
5. DEV: открыть локально (file://), загрузить `prices.dev.json` вручную и пройтись по тест-бейджу.

---

## Пример полного файла

```json
{
  "meta": { "version": "2.3.0", "updated": "2025-10-17" },

  "shared": {
    "fees": {
      "designFee": {
        "none": 0,
        "template": 0,
        "premium": 1500
      }
    }
  },

  "products": {
    "leaflets": {
      "base": {
        "sizes": ["A6","A5","A4","EURO","A3"],
        "gsmList": ["80","115","150","200","300"],
        "basePerItemSingle": {
          "A6":  { "80": 8,  "115": 10, "150": 12, "200": 13,  "300": 15 },
          "A5":  { "80": 15, "115": 20, "150": 23, "200": 25,  "300": 30 },
          "A4":  { "80": 30, "115": 40, "150": 45, "200": 50,  "300": 60 },
          "EURO":{"80": 30, "115": 40, "150": 45, "200": 50,  "300": 60 },
          "A3":  { "80": 50, "115": 70, "150": 85, "200": 100, "300": 120 }
        },
        "doublePrintMultiplier": 1.40
      },
      "options": {
        "laminationMultiplier": 1.40,
        "roundedCornersPerItem": 2.0,
        "creasingPerLine": 3.0,
        "designerPaperMultiplier": 1.30
      },
      "urgencyK": { "oneday": 1.0, "express": 1.5 },
      "qtyRules": { "min": 1, "pack": 1 },
      "discountByAmount": {
        "startAmount": 1500,  "startRate": 0.05,
        "midAmount":   4000,  "midRate":   0.15,
        "capAmount":  20000,  "capRate":   0.30
      }
    },

    "cards": {
      "base": {
        "sizes": ["90x50","60x60"],
        "basePerItem": {
          "paper300": { "single": 5,   "double": 9   },
          "designer": { "single": 30,  "double": 40  },
          "plastic":  { "single": 100, "double": 200 }
        }
      },
      "options": {
        "laminationMultiplier": 2.0,
        "roundedCornersPerItem": 2.0
      },
      "urgencyK": { "oneday": 1.0, "express": 1.5 },
      "qtyRules": {
        "min": 120,
        "pack": 24,
        "perMaterial": {
          "paper300": { "min": 120, "pack": 24 },
          "designer": { "min": 120, "pack": 24 },
          "plastic":  { "min": 30,  "pack": 1  }
        }
      },
      "discountByAmount": {
        "startAmount": 1500,  "startRate": 0.05,
        "midAmount":   4000,  "midRate":   0.15,
        "capAmount":  20000,  "capRate":   0.30
      }
    }
  }
}
```
