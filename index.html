<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Калькулятор визиток / листовок</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="./app.css" rel="stylesheet" />
</head>
<body>
  <div class="container py-4">
    <div class="d-flex align-items-center justify-content-between mb-3">
      <h1 class="h3 m-0">Калькулятор визиток</h1>
      <div class="d-flex align-items-center gap-2">
        <!-- Бейдж тестов виден только в локальном режиме (покажем через JS) -->
        <span id="testBadge" class="badge text-bg-secondary test-badge d-none">Тесты не запускались</span>
        <button id="btnShare" class="btn btn-outline-light btn-sm" type="button">Поделиться расчётом</button>
        <button id="btnReset" class="btn btn-outline-warning btn-sm" type="button">Сброс</button>
      </div>
    </div>
    <div class="accent-bar mb-3"></div>

    <!-- Панель дев-инструментов (видна только локально) -->
    <div id="devPanel" class="alert alert-info py-2 d-none">
      <div class="d-flex flex-wrap align-items-center gap-2">
        <strong class="me-1">DEV режим:</strong>
        <button id="btnLoadDevPrices" class="btn btn-sm btn-primary" type="button">Загрузить prices.dev.json</button>
        <input id="priceFile" type="file" accept="application/json" class="form-control form-control-sm" style="max-width:280px; display:none;" />
        <span class="small text-muted">или откройте страницу с параметром <code>?env=dev</code></span>
      </div>
    </div>

    <div class="alert alert-warning py-2">Размеры ниже соответствуют примеру (листовки: A6…A3 и «Евро 210×98»). Для классических визиток обычно 90×50 мм — если нужно, добавлю отдельный пресет.</div>

    <div class="position-relative">
      <!-- Блокировка интерфейса до загрузки прайсов -->
      <div id="lockOverlay" class="lock-overlay d-flex flex-column align-items-center justify-content-center">
        <div class="text-center">
          <div class="spinner-border mb-2" role="status" aria-hidden="true"></div>
          <div id="lockMessage">Загружаем цены…</div>
          <div id="lockHint" class="small text-muted mt-1"></div>
        </div>
      </div>

      <div class="row g-4" id="calcRoot" aria-disabled="true">
        <div class="col-lg-8">
          <div class="card p-3 p-md-4">
            <div class="row g-3">
              <!-- Дизайн -->
              <div class="col-12">
                <label class="form-label">Дизайн</label>
                <div class="btn-group option-pill" role="group">
                  <input type="radio" class="btn-check" name="design" id="design_template" value="template">
                  <label class="btn btn-outline-light" for="design_template">Создам по бесплатному онлайн шаблону</label>

                  <input type="radio" class="btn-check" name="design" id="design_none" value="none" checked>
                  <label class="btn btn-outline-light" for="design_none">Есть готовый макет</label>

                  <input type="radio" class="btn-check" name="design" id="design_premium" value="premium">
                  <label class="btn btn-outline-light" for="design_premium">Закажу уникальный дизайн</label>
                </div>
              </div>

              <!-- Размер -->
              <div class="col-12">
                <label class="form-label">Размер</label>
                <div class="btn-group option-pill flex-wrap" role="group">
                  <input type="radio" class="btn-check" name="size" id="size_a6" value="A6" checked>
                  <label class="btn btn-outline-light" for="size_a6">A6</label>

                  <input type="radio" class="btn-check" name="size" id="size_a5" value="A5">
                  <label class="btn btn-outline-light" for="size_a5">A5</label>

                  <input type="radio" class="btn-check" name="size" id="size_a4" value="A4">
                  <label class="btn btn-outline-light" for="size_a4">A4</label>

                  <input type="radio" class="btn-check" name="size" id="size_a3" value="A3">
                  <label class="btn btn-outline-light" for="size_a3">A3</label>

                  <input type="radio" class="btn-check" name="size" id="size_euro" value="EURO">
                  <label class="btn btn-outline-light" for="size_euro" data-bs-toggle="tooltip" data-bs-title="210×98 мм">Евро</label>
                </div>
              </div>

              <!-- Печать -->
              <div class="col-md-4">
                <label class="form-label">Печать</label>
                <select id="print" class="form-select">
                  <option value="single">Односторонняя</option>
                  <option value="double">Двусторонняя</option>
                </select>
              </div>

              <!-- Бумага (тип) -->
              <div class="col-12">
                <label class="form-label">Бумага</label>
                <div class="row g-2">
                  <div class="col-sm-6 col-lg-3">
                    <div class="form-check">
                      <input class="form-check-input" type="radio" name="stock" id="stock_gloss" value="gloss" checked>
                      <label class="form-check-label" for="stock_gloss">Глянцевая</label>
                    </div>
                  </div>
                  <div class="col-sm-6 col-lg-3">
                    <div class="form-check">
                      <input class="form-check-input" type="radio" name="stock" id="stock_matte" value="matte">
                      <label class="form-check-label" for="stock_matte">Матовая</label>
                    </div>
                  </div>
                  <div class="col-sm-6 col-lg-3">
                    <div class="form-check">
                      <input class="form-check-input" type="radio" name="stock" id="stock_ccg" value="ccg">
                      <label class="form-check-label" for="stock_ccg" data-bs-toggle="tooltip" data-bs-title="Бумага повышенной белизны с глянцевым покрытием. Более насыщенные цвета. Made in Austria.">Color Copy Gloss</label>
                    </div>
                  </div>
                  <div class="col-sm-6 col-lg-3">
                    <div class="form-check">
                      <input class="form-check-input" type="radio" name="stock" id="stock_dns" value="dns">
                      <label class="form-check-label" for="stock_dns" data-bs-toggle="tooltip" data-bs-title="Повышенная белизна, без покрытия. Удобно писать ручкой.">DNS без покрытия</label>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Плотность -->
              <div class="col-12">
                <label class="form-label">Плотность бумаги (г/м²)</label>
                <div class="btn-group option-pill flex-wrap" role="group">
                  <input type="radio" class="btn-check" name="gsm" id="gsm_130" value="130" checked>
                  <label class="btn btn-outline-light" for="gsm_130" data-bs-toggle="tooltip" data-bs-title="130 — стандартная плотность">130</label>

                  <input type="radio" class="btn-check" name="gsm" id="gsm_170" value="170">
                  <label class="btn btn-outline-light" for="gsm_170">170 <span class="muted">(+0.25 ₽/шт.)</span></label>

                  <input type="radio" class="btn-check" name="gsm" id="gsm_200" value="200">
                  <label class="btn btn-outline-light" for="gsm_200">200 <span class="muted">(+0.35 ₽/шт.)</span></label>

                  <input type="radio" class="btn-check" name="gsm" id="gsm_300" value="300">
                  <label class="btn btn-outline-light" for="gsm_300" data-bs-toggle="tooltip" data-bs-title="На 300 г/м² часто печатают визитки">300 <span class="muted">(+1.50 ₽/шт.)</span></label>
                </div>
              </div>

              <!-- Тираж и срок -->
              <div class="col-md-6">
                <label class="form-label">Количество</label>
                <div class="input-group qty-input">
                  <select id="qtyPreset" class="form-select">
                    <option value="50">50 шт.</option>
                    <option value="100">100 шт.</option>
                    <option value="200">200 шт.</option>
                    <option value="300">300 шт.</option>
                    <option value="400">400 шт.</option>
                    <option value="500" selected>500 шт.</option>
                    <option value="700">700 шт.</option>
                    <option value="1000">1000 шт.</option>
                    <option value="custom">Свой</option>
                  </select>
                  <input id="qty" type="number" min="50" step="50" class="form-control" value="500">
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Срок изготовления</label>
                <select id="urgency" class="form-select">
                  <option value="standard">2 рабочих дня</option>
                  <option value="urgent">1 рабочий день (+25%)</option>
                  <option value="express">2–3 часа (+100%)</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <!-- Итоги -->
        <div class="col-lg-4">
          <div class="card p-3 p-md-4 sticky-summary" id="summaryCard">
            <div class="d-flex align-items-center justify-content-between mb-2">
              <span class="badge badge-soft">ИТОГ</span>
            </div>
            <div id="eta" class="small muted mb-2"></div>
            <div class="price-xl" id="total">0 ₽</div>
            <div class="muted">с НДС 20%</div>
            <div class="divider"></div>
            <table class="table table-sm table-dark align-middle mb-2">
              <tbody>
                <tr><td>Размер</td><td class="text-end" id="lineSize">—</td></tr>
                <tr><td>Бумага</td><td class="text-end" id="lineStock">—</td></tr>
                <tr><td>Плотность</td><td class="text-end" id="lineGsm">—</td></tr>
                <tr><td>Печать</td><td class="text-end" id="linePrint">—</td></tr>
                <tr><td>Скидка за тираж</td><td class="text-end text-success" id="lineDiscount">—</td></tr>
                <tr><td>Срочность</td><td class="text-end" id="lineUrgency">×1.00</td></tr>
                <tr><td>Дизайн</td><td class="text-end" id="lineDesign">—</td></tr>
                <tr class="table-active"><th>Итого без НДС</th><th class="text-end" id="subtotal">—</th></tr>
                <tr><td>НДС 20%</td><td class="text-end" id="vat">—</td></tr>
              </tbody>
            </table>
            <div class="d-grid gap-2">
              <button id="btnDownload" class="btn btn-primary" type="button">Скачать спецификацию (PDF)</button>
              <span class="small-note text-center">*Цена ориентировочная, без учёта сложных доп. работ</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Панель отладки цен — показывается только локально -->
    <details id="devPricesDetails" class="mt-4 d-none"><summary>Показать/скрыть используемые цены (для проверки)</summary>
      <pre id="priceJson" class="mt-2 small"></pre>
    </details>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="./app.js"></script>
</body>
</html>
